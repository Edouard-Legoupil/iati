# WARNING - Generated by {fusen} from dev/dev_data_reshape.Rmd: do not edit by hand # nolint: line_length_linter.

#' @noRd
iati_result <- function(xml_iati, verbose = TRUE) {
  log_debug("Extracting results...", verbose = verbose)
  indicator_nodes <- xml2::xml_find_all(xml_iati, './/iati-activity/result/indicator')
  log_debug("Found ", length(indicator_nodes), " result indicator nodes.", verbose = verbose)
  df <- purrr::map_dfr(indicator_nodes, function(node) {
    tibble::tibble(
      iati_identifier = get_xml_value(node, "ancestor::iati-activity/iati-identifier"),
      result_type = get_xml_value(node, "ancestor::result", attr = "type"),
      result_aggregation_status = get_xml_value(node, "ancestor::result", attr = "aggregation-status"),
      result_title = get_xml_value(node, "ancestor::result/title/narrative"),
      result_desc = get_xml_value(node, "ancestor::result/description/narrative"),
      
      result_indicator_title = get_xml_value(node, "title/narrative"),
      result_indicator_measure = get_xml_value(node, ".", "measure"),
      result_indicator_aggregation_status = get_xml_value(node, ".", "aggregation-status"),
      result_indicator_ascending = get_xml_value(node, ".", "ascending"),
      
      result_indicator_reference_code = get_xml_value(node, "reference", "code"),
      result_indicator_reference_uri = get_xml_value(node, "reference", "indicator-uri"),
      result_indicator_reference_vocabulary = get_xml_value(node, "reference", "vocabulary"),
      
      result_indicator_baseline_value = get_xml_value(node, "baseline", "value"),
      result_indicator_baseline_year = get_xml_value(node, "baseline", "year"),
      result_indicator_baseline_location_ref = get_xml_value(node, "baseline/location", "ref"),
      result_indicator_baseline_dimension_1 = get_xml_value(node, "baseline/dimension", "name", pos = 1),
      result_indicator_baseline_dimension_value_1 = get_xml_value(node, "baseline/dimension", "value", pos = 1),
      result_indicator_baseline_dimension_2 = get_xml_value(node, "baseline/dimension", "name", pos = 2),
      result_indicator_baseline_dimension_value_2 = get_xml_value(node, "baseline/dimension", "value", pos = 2),

      result_indicator_period_start = get_xml_value(node, "period/period-start", "iso-date"),
      result_indicator_period_end = get_xml_value(node, "period/period-end", "iso-date"),
      
      result_indicator_target_value = get_xml_value(node, "period/target", "value"),
      result_indicator_target_location_ref = get_xml_value(node, "period/target/location", "ref"),
      result_indicator_target_dimension_1 = get_xml_value(node, "period/target/dimension", "name", pos = 1),
      result_indicator_target_value_1 = get_xml_value(node, "period/target/dimension", "value", pos = 1),
      result_indicator_target_dimension_2 = get_xml_value(node, "period/target/dimension", "name", pos = 2),
      result_indicator_target_value_2 = get_xml_value(node, "period/target/dimension", "value", pos = 2),
      
      result_indicator_actual_value = get_xml_value(node, "period/actual", "value"),
      result_indicator_actual_location_ref = get_xml_value(node, "period/actual/location", "ref"),
      result_indicator_actual_dimension_1 = get_xml_value(node, "period/actual/dimension", "name", pos = 1),
      result_indicator_actual_value_1 = get_xml_value(node, "period/actual/dimension", "value", pos = 1),
      result_indicator_actual_dimension_2 = get_xml_value(node, "period/actual/dimension", "name", pos = 2),
      result_indicator_actual_value_2 = get_xml_value(node, "period/actual/dimension", "value", pos = 2)
    )
  })
  log_debug("Finished extracting results. Rows: ", nrow(df), verbose = verbose)
  return(df)
}
